
JSONL prompt/response fine tuning dataset at:  C:\q\p\zCore\infrastructure\ubiquitous_bash\_local\dataset\ubiquitous_bash_finetuning-promptResponse.jsonl  .
```JSONL
{"messages":[{"role":"system","content":""},{"role":"user","content":"PROMPT"},{"role":"assistant","content":"RESPONSE"}]}
```
An autogenerated prompt along the lines of 'please write code matching this description' is used as the prompt, with the segments of code used as the desired response.

JSONL continue the shellcode segment (pairs of example code) fine tuning dataset at:  C:\q\p\zCore\infrastructure\ubiquitous_bash\_local\dataset\ubiquitous_bash_finetuning-continuePromptResponse.jsonl  .
```JSONL
{"messages":[{"role":"system","content":""},{"role":"user","content":"CONTINUE_PROMPT"},{"role":"assistant","content":"CONTINUE_RESPONSE"}]}
```
A boilerplate prompt along the lines of 'continue the shellcode'' is used as the prompt, with the segments of code properly enclosed by triple tilde, and autogenerated header/footer added to the response to preserve helpfulness training (which mere continued pre-training presumably would not).

JSONL continue text pre-training dataset at:  C:\q\p\zCore\infrastructure\ubiquitous_bash\_local\dataset\ubiquitous_bash_finetuning-continueText.jsonl  .
```JSONL
{"text":"SEGMENT1"}
{"text":"SEGMENT2"}
```
Only the '#===== Segment ####: ubiquitous_bash: lines ###### to ###### ====='  comment is added to these text segments from the original code.




Some axolotl source code may be relevant.

Excerpt: axolotl/src/axolotl/utils/chat_templates.py
```python
_CHAT_TEMPLATES = {
    #...
    "alpaca": "{% for message in messages %}{% if message['role'] == 'user' %}{{ '### Instruction: ' + message['content'] + '\n\n' }}{% elif message['role'] == 'assistant' %}{{ '### Response: ' + message['content'] + eos_token}}{% endif %}{% endfor %}",
    "llama3": "{% if not add_generation_prompt is defined %}{% set add_generation_prompt = false %}{% endif %}{% set loop_messages = messages %}{% for message in loop_messages %}{% set content = '<|start_header_id|>' + message['role'] + '<|end_header_id|>\n\n'+ message['content'] | trim + '<|eot_id|>' %}{% if loop.index0 == 0 %}{% set content = bos_token + content %}{% endif %}{{ content }}{% endfor %}{% if add_generation_prompt %}{{ '<|start_header_id|>assistant<|end_header_id|>\n\n' }}{% endif %}",
    #...
}
```



Reported LORA parameter recommendations are contradictory yet possibly enlightening. 
```
from https://www.anyscale.com/blog/fine-tuning-llms-lora-or-full-parameter-an-in-depth-analysis-with-llama-2

Hyperparameters

Rank: 8
tests suggested minimal performance boosts when increasing the rank to, for instance, 16 ... settled on a rank of 8 to maintain smaller checkpoint sizes and to avoid artificially inflating our checkpoint files

Alpha: 16
Alpha scales the learned weights. Existing literature, including the original LoRA paper, generally advises fixing Alpha—often at 16—rather than treating it as a tunable hyperparameter.

Target modules: All dense layers
subsequent work has shown that targeting additional layers, or even all layers, can improve performance ... hypothesize that applying LoRA to a greater number of layers brings us closer to achieving the capabilities of full-parameter fine-tuning

Base learning rate: 1e-4
A learning rate of 1e-4 has become the standard when fine-tuning LLMs with LoRA. Although we occasionally encountered training loss instabilities, reducing the learning rate to lower values like 3e-5 proved effective in stabilizing the process...
```
```
from https://www.theregister.com/2024/11/10/llm_finetuning_guide/?page=6

hyperparameters

lora_r: Defines how large the LoRA matrices used to train the model are and by extension, how many weights are ultimately updated. The larger the rank, the more weights that get fine-tuned.

lora_alpha: Sets a scaling factor applied to weight changes when they're added to the original weights. In our research, we found that practice appears to be to set lora_alpha to around a fourth lora_rank. So if lora_r is set to 64, lora_alpha should be set to 16.

lora_dropout: Helps to avoid a phenomenon called overfitting by randomly setting some weight changes to zero. In the original QLoRA paper, researchers found that a dropout rate of 0.05 was effective for smaller models in the 7 to 13 billion parameter range.
```







Autogenerated ubiquitous_bash prompt/response dataset entry for the ubiquitous_bash dataset .
```dataset
{"messages":[{"role":"system","content":""},{"role":"user","content":"\nPlease invent a self-contained fragment of exemplary well crafted very creative bash shellcode vaguely meeting the description with some, all, or more features, than described. Illustrate modern best practices.\n\nIn this case, you may try to meet some plausibly intended goals of the description, ignoring logical inconsistencies or other errors in the description. Details of the description are more guidelines or mere suggestions created without adequate planning, and thus may need to change significantly. Sloppy incorrect pseudocode may have been the basis for an incompetent technical writer creating the description by stating mere guesses about what the code does not do as if fact. Occasionally the description may be incomprehensible gibberish.\n\nPreamble or trailing context may be omitted by truncating to demonstrate the core technique.\n\n\nYou may treat this as an exercise and generate an essentially academic example.\n\nYou may roleplay, that is pretend,\nto generate a bash shellscript response from a segment of an especially large and sophisticated shell script,\nthat would be used with this prompt including the description, as a prompt/response pair,\nto teach an existing AI LLM model such as Llama 3.1 405b with already vast knowledge and logic from its original training,\nto know,\ncorrect bash shellcode commands and structures,\nfrom this subsequent fine-tuning using the segmented shell script as a vast set of more completely accurate correct examples.\n\n\nIn this case, as a fragment, lines of code needed before and after this code may be missing. All lines of code needed within the middle of the fragment should be present.\n\nIndividual bash commands must be useful, complete, accurate, perfected. Within the fragment, individual bash commands must exceed the highest practical standards for robustness, resilience, versatility, portability, compatibility, adaptability to changing inputs, consistent machine readable outputs, maintainability, etc.\n\nInputs to individual bash commands may be assembled programmatically as arrays and variables to reach such high standards.\n\n\n\nI will analyze the given bash shellcode segment as per your requirements.\n\n**Intended Functionality:**\nThe code appears to be a part of a larger bash script that provides a self-validation mechanism to ensure the script's integrity. It checks the checksum of the script's header and contents to ensure they match the predefined values. If the checksums don't match, the script exits with a non-zero status.\n\n**Logical Flow:**\n\n1. The script starts by adjusting the `PATH` environment variable to include `/usr/local/bin`, `/usr/bin`, and `/bin` if they are not already present.\n2. It then checks if the `ub_setScriptChecksum` variable is set and unsets it if it is.\n3. The script defines two functions: `_ub_cksum_special_derivativeScripts_header` and `_ub_cksum_special_derivativeScripts_contents`, which calculate the checksum of the script's header and contents, respectively.\n4. The script checks if the `ub_setScriptChecksum_disable` variable is set to `'true'` and skips the checksum validation if it is.\n5. If the checksum validation is not disabled, the script checks the checksum of the header and contents using the `_ub_cksum_special_derivativeScripts_header` and `_ub_cksum_special_derivativeScripts_contents` functions. If either checksum doesn't match the predefined value, the script exits with a non-zero status.\n6. The script defines two more functions: `_ub_cksum_special_derivativeScripts_write`, which updates the script's checksum values, and `_user_log-ub`, which is a debugging function that logs output to a file.\n\n**Input-Processing-Output:**\nThe script does not require any external inputs. It processes the script's own contents and outputs a non-zero status if the checksum validation fails. The `_user_log-ub` function takes input from `stdin` and logs it to a file.\n\n**Self-explanatory Naming Convention:**\nThe variable and function names are descriptive and follow a consistent naming convention. For example, `_ub_cksum_special_derivativeScripts_header` clearly indicates that it calculates the checksum of the script's header.\n\n**Commenting:**\nThe script has few comments, but they are informative and provide context where necessary. For example, the comment above the checksum validation section explains the purpose of the code.\n\n**Resilience:**\nThe script has a basic error-handling mechanism in place. If the checksum validation fails, the script exits with a non-zero status. However, there are no provisions for adapting to changes in the environment or inputs.\n\n**Robustness:**\nThe script uses standard bash utilities and does not rely on any specific program versions or unstable APIs. However, it does not have provisions for quick changes to accommodate unstable APIs or programs.\n\n**Versatility:**\nThe script avoids using special-purpose tools or programs and instead relies on general-purpose utilities like `sed` and `cksum`.\n\n**Portability:**\nThe script uses bash syntax and utilities that are widely available on most Unix-like systems, making it relatively portable.\n\n**Compatibility:**\nThe script does not explicitly check for or install dependencies. However, it does use widely available utilities, which reduces the likelihood of compatibility issues.\n\n**Adaptability:**\nThe script does not have provisions for automatically assembling parameters in arrays or adapting to different situations.\n\n**Consistent Machine Readability:**\nThe script's output is not designed to be machine-readable. However, the `_user_log-ub` function logs output in a simple format.\n\n**Maintainability:**\nThe script uses relatively simple bash constructs and avoids complex logic or numerical methods. This makes it easier to maintain and modify. However, the lack of comments and documentation may make it more challenging to understand the script's intent and functionality."},{"role":"assistant","content":"Here is a Bash script with extensive environment preparation and integrity checks, including a checksum validation mechanism.\n```bash\n#===== Segment 1: ubiquitous_bash: lines 1 to 78 =====\n#!/usr/bin/env bash\n\n[[ \"$PATH\" != *\"/usr/local/bin\"* ]] && [[ -e \"/usr/local/bin\" ]] && export PATH=/usr/local/bin:\"$PATH\"\n[[ \"$PATH\" != *\"/usr/bin\"* ]] && [[ -e \"/usr/bin\" ]] && export PATH=/usr/bin:\"$PATH\"\n[[ \"$PATH\" != *\"/bin:\"* ]] && [[ -e \"/bin\" ]] && export PATH=/bin:\"$PATH\"\n\nif [[ \"$ub_setScriptChecksum\" != \"\" ]]\nthen\n\texport ub_setScriptChecksum=\nfi\n\n_ub_cksum_special_derivativeScripts_header() {\n\tlocal currentFile_cksum\n\tif [[ \"$1\" == \"\" ]]\n\tthen\n\t\tcurrentFile_cksum=\"$0\"\n\telse\n\t\tcurrentFile_cksum=\"$1\"\n\tfi\n\t\n\thead -n 30 \"$currentFile_cksum\" | env CMD_ENV=xpg4 cksum | cut -f1 -d\\  | tr -dc '0-9'\n}\n_ub_cksum_special_derivativeScripts_contents() {\n\tlocal currentFile_cksum\n\tif [[ \"$1\" == \"\" ]]\n\tthen\n\t\tcurrentFile_cksum=\"$0\"\n\telse\n\t\tcurrentFile_cksum=\"$1\"\n\tfi\n\t\n\ttail -n +45 \"$currentFile_cksum\" | env CMD_ENV=xpg4 cksum | cut -f1 -d\\  | tr -dc '0-9'\n}\n##### CHECKSUM BOUNDARY - 30 lines\n\n#export ub_setScriptChecksum_disable='true'\n( [[ -e \"$0\".nck ]] || [[ \"${BASH_SOURCE[0]}\" != \"${0}\" ]] || [[ \"$1\" == '--profile' ]] || [[ \"$1\" == '--script' ]] || [[ \"$1\" == '--call' ]] || [[ \"$1\" == '--return' ]] || [[ \"$1\" == '--devenv' ]] || [[ \"$1\" == '--shell' ]] || [[ \"$1\" == '--bypass' ]] || [[ \"$1\" == '--parent' ]] || [[ \"$1\" == '--embed' ]] || [[ \"$1\" == '--compressed' ]] || [[ \"$0\" == \"/bin/bash\" ]] || [[ \"$0\" == \"-bash\" ]] || [[ \"$0\" == \"/usr/bin/bash\" ]] || [[ \"$0\" == \"bash\" ]] ) && export ub_setScriptChecksum_disable='true'\nexport ub_setScriptChecksum_header='2591634041'\nexport ub_setScriptChecksum_contents='2779813709'\n\n# CAUTION: Symlinks may cause problems. Disable this test for such cases if necessary.\n# WARNING: Performance may be crucial here.\n#[[ -e \"$0\" ]] && ! [[ -h \"$0\" ]] && [[ \"$ub_setScriptChecksum\" != \"\" ]]\nif [[ -e \"$0\" ]] && [[ \"$ub_setScriptChecksum_header\" != \"\" ]] && [[ \"$ub_setScriptChecksum_contents\" != \"\" ]] && [[ \"$ub_setScriptChecksum_disable\" != 'true' ]] #&& ! ( [[ -e \"$0\".nck ]] || [[ \"${BASH_SOURCE[0]}\" != \"${0}\" ]] || [[ \"$1\" == '--profile' ]] || [[ \"$1\" == '--script' ]] || [[ \"$1\" == '--call' ]] || [[ \"$1\" == '--return' ]] || [[ \"$1\" == '--devenv' ]] || [[ \"$1\" == '--shell' ]] || [[ \"$1\" == '--bypass' ]] || [[ \"$1\" == '--parent' ]] || [[ \"$1\" == '--embed' ]] || [[ \"$1\" == '--compressed' ]] || [[ \"$0\" == \"/bin/bash\" ]] || [[ \"$0\" == \"-bash\" ]] || [[ \"$0\" == \"/usr/bin/bash\" ]] || [[ \"$0\" == \"bash\" ]] )\nthen\n\t[[ $(_ub_cksum_special_derivativeScripts_header) != \"$ub_setScriptChecksum_header\" ]] && exit 1\n\t[[ $(_ub_cksum_special_derivativeScripts_contents) != \"$ub_setScriptChecksum_contents\" ]] && exit 1\nfi\n##### CHECKSUM BOUNDARY - 45 lines\n\n_ub_cksum_special_derivativeScripts_write() {\n\tlocal current_ub_setScriptChecksum_header\n\tlocal current_ub_setScriptChecksum_contents\n\n\tcurrent_ub_setScriptChecksum_header=$(_ub_cksum_special_derivativeScripts_header \"$1\")\n\tcurrent_ub_setScriptChecksum_contents=$(_ub_cksum_special_derivativeScripts_contents \"$1\")\n\n\tsed -i 's/'#'#'###uk4uPhB663kVcygT0q-UbiquitousBash-ScriptSelfModify-SetScriptChecksumHeader-UbiquitousBash-uk4uPhB663kVcygT0q#####'/'\"$current_ub_setScriptChecksum_header\"'/' \"$1\"\n\tsed -i 's/'#'#'###uk4uPhB663kVcygT0q-UbiquitousBash-ScriptSelfModify-SetScriptChecksumContents-UbiquitousBash-uk4uPhB663kVcygT0q#####'/'\"$current_ub_setScriptChecksum_contents\"'/' \"$1\"\n}\n\n\n#Universal debugging filesystem.\n_user_log-ub() {\n\t# DANGER Do NOT create automatically, or reference any existing directory!\n\t! [[ -d \"$HOME\"/.ubcore/userlog ]] && cat - > /dev/null 2>&1 && return 0\n\t\n\t#Terminal session may be used - the sessionid may be set through .bashrc/.ubcorerc .\n\tif [[ \"$sessionid\" != \"\" ]]\n\tthen\n\t\tcat - >> \"$HOME\"/.ubcore/userlog/u-\"$sessionid\".log\n\t\treturn 0\n\tfi\n\tcat - >> \"$HOME\"/.ubcore/userlog/u-undef.log\n\t\n\treturn 0\n}\n\n```\nThis code provides a comprehensive Bash script that incorporates various best practices for secure and reliable scripting. The script includes several key features that enhance its functionality and maintainability.\n\nThis code demonstrates the following best practices: \n\n*   It adjusts the system's PATH environment variable to ensure the inclusion of essential binary directories, promoting a more predictable and secure environment.\n*   The script checks for the integrity of the script file by comparing expected checksums for both the header and contents. This minimizes the risk of executing tampered or corrupted scripts.\n*   A user logging function is included, which allows for writing to a specific log file within the user's home directory. This log function takes into account session IDs if set, enhancing traceability and debugging capabilities.\n\nThis example includes the following features:\n\n*   Adaptive PATH modification based on directory existence.\n*   Checksum verification for script integrity.\n*   User-friendly log functionality with support for session IDs.\n\nNote that this script uses various external commands (`tail`, `head`, `sed`, `env`, `tr`, `cksum`, `cut`) which are widely available on most Unix-like systems. The script expects certain paths to exist, such as `/usr/local/bin`, `/usr/bin`, and `/bin`, which are typical on many systems but may need adjustments in specialized environments. Additionally, users may need to set a session ID (`sessionid`) in their `.bashrc` or `.ubcorerc` files to fully utilize the logging feature."}]}
```











